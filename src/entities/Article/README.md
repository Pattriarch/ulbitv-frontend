# Сущность "Статья"

## Описание:
Статья представляет собой основную единицу контента в нашем приложении, созданную для удовлетворения информационных потребностей пользователей. Это не просто последовательность текстовых блоков: каждая статья имеет свой уникальный идентификатор, заголовок, подзаголовок и, возможно, главное изображение. Статьи могут быть категоризированы по типам (например, IT, экономика), имеют дату публикации и количество просмотров. Важной особенностью статьи является её модульная структура: она состоит из разных блоков (текст, изображения, код), что позволяет авторам гибко управлять контентом. Кроме того, каждая статья ассоциируется с определенным пользователем, который является её автором.

### Ниже описаны компоненты, типы, сервисы и селекторы для Public API

---
# Компоненты

### `ArticleCard`

Компонент для отображения карточки статьи.

**Пропсы**

- `className?: string`: Дополнительные стили карточки.
- `data?: Article`: Данные статьи.
- `isLoading?: boolean`: Флаг индикации загрузки.
- `error?: string`: Текст ошибки.
- `onChangeImage?: (value: string) => void`: Обработчик изменения изображения статьи.
- `onChangeTitle?: (value: string) => void`: Обработчик изменения заголовка статьи.
- `onChangeSubtitle: (value: string) => void`: Обработчик изменения подзаголовка статьи.
- `onAddCodeBlock?: () => void`: Обработчик добавления блока кода в статью.
- `onAddTextBlock?: () => void`: Обработчик добавления текстового блока в статью.
- `onAddImageBlock?: () => void`: Обработчик добавления блока изображения в статью.
- `dragStartHandler: (e: DragEvent<HTMLDivElement>, editBlock: ArticleBlock) => void`: Обработчик начала перетаскивания блока в статье.
- `dragEndHandler: (e: DragEvent<HTMLDivElement>) => void`: Обработчик завершения перетаскивания блока в статье.
- `dragOverHandler: (e: DragEvent<HTMLDivElement>) => void`: Обработчик события перетаскивания над блоком в статье.
- `dropHandler: (e: DragEvent<HTMLDivElement>, editBlock: ArticleBlock) => void`: Обработчик события отпускания блока при перетаскивании в статье.
- `onRemoveBlock: (id: string) => void`: Обработчик удаления блока из статьи.
- `sortBlocks: (a: ArticleBlock, b: ArticleBlock) => number`: Функция сортировки блоков в статье.
- `onChangeBlockState: (editedBlock: ArticleBlock) => void`: Обработчик изменения состояния блока в статье.

---

### `ArticleDetails`

Компонент для отображения деталей статьи.

**Пропсы**

- `className?: string`: Опциональный класс для стилизации.
- `id?: string`: Идентификатор статьи.

---

### `ArticleList`

Компонент для отображения списка статей.

**Пропсы**

- `Header?: () => ReactNode`: Функциональный компонент для заголовка списка.
- `className?: string`: Опциональный класс для стилизации.
- `articles: Article[]`: Массив статей для отображения.
- `view?: ArticleView`: Определяет вид отображения статей.
- `isLoading?: boolean`: Определяет, выполняется ли загрузка данных.
- `target?: HTMLAttributeAnchorTarget`: Значение для атрибута `target` тега `<a>`.
- `onLoadNextPart?: () => void`: Обработчик события достижения конца списка для подгрузки следующей порции данных.
- `lastScrolledIndex?: number`: Индекс последнего прокрученного элемента.
- `setLastScrolledIndex?: (index: number) => void`: Функция для установки значения последнего прокрученного элемента.
- `virtualized?: boolean`: Опция для включения виртуализации (используется `react-virtuoso`).

---

### `ArticleDetailsContainer`

Контейнер для отображения деталей статьи.

**Пропсы**

- `className?: string`: Опциональный класс для стилизации.

---

# Типы

---

### `Article`

Интерфейс статьи.

**Пропсы**

- `id?: string`: Уникальный идентификатор статьи.
- `title?: string`: Заголовок статьи.
- `user?: User`: Автор статьи.
- `subtitle?: string`: Подзаголовок статьи.
- `img?: string`: URL-ссылка на главное изображение статьи.
- `views?: number`: Количество просмотров статьи.
- `createdAt?: string`: Дата создания статьи.
- `type?: ArticleType[]`: Типы статьи (например, IT, экономика и др.).
- `blocks?: ArticleBlock[]`: Блоки, из которых состоит статья.

---

### `ArticleBlock`

Обобщенный тип для всех типов блоков статьи.

- `ArticleCodeBlock`
- `ArticleImageBlock`
- `ArticleTextBlock`

---

### `ArticleCodeBlock`

Блок кода в статье.

**Пропсы**

- `id: string`: Уникальный идентификатор блока.
- `type: ArticleBlockType.CODE`: Тип блока — код.
- `order: number`: Порядковый номер блока в статье.
- `code: string`: Содержимое блока с кодом.

---

### `ArticleImageBlock`

Блок изображения в статье.

**Пропсы**

- `id: string`: Уникальный идентификатор блока.
- `type: ArticleBlockType.IMAGE`: Тип блока — изображение.
- `order: number`: Порядковый номер блока в статье.
- `title: string`: Название изображения.
- `src: string`: URL-ссылка на изображение.

---

### `ArticleTextBlock`

Текстовый блок в статье.

**Пропсы**

- `id: string`: Уникальный идентификатор блока.
- `type: ArticleBlockType.TEXT`: Тип блока — текст.
- `order: number`: Порядковый номер блока в статье.
- `title?: string`: Заголовок текстового блока.
- `paragraphs: string[]`: Абзацы текстового блока.

---

### `ArticleBlockBase`

Базовый интерфейс блока в статье.

**Пропсы**

- `id: string`: Уникальный идентификатор блока.
- `type: ArticleBlockType`: Тип блока.
- `order: number`: Порядковый номер блока в статье.

`Article` - Тип, описывающий статью

---

### `ArticleDetailsSchema`

Схема детализации статьи.

**Пропсы**

- `isLoading?: boolean`: Флаг загрузки статьи.
- `error?: string`: Ошибка при загрузке статьи.
- `data?: Article`: Данные о статье.

---

# Сервисы

### `fetchArticleById`

Асинхронный запрос для получения статьи по ID.

**Принимает**

- `articleId: string | undefined` - ID статьи для загрузки.

**Возвращает**

Промис, возвращающий данные статьи.

**Бросает**

Ошибка, если ID статьи не предоставлен или ответ сервера пустой.

**Примечание**

Функция использует `createAsyncThunk` из Redux Toolkit для создания асинхронного экшена. Она принимает в качестве аргумента ID статьи и объект `thunkAPI`, который предоставляет доступ к дополнительным возможностям, таким как доступ к API через `extra.api` и функция `rejectWithValue` для обработки ошибок.

Функция выполняет следующие шаги:

1. Проверяет, предоставлен ли `articleId`. Если ID статьи отсутствует, выбрасывает ошибку.
2. Отправляет GET-запрос на сервер, используя предоставленный `articleId`, и расширяет получаемые данные информацией о пользователе (`_expand: 'user'`).
3. Проверяет, содержит ли ответ сервера данные. Если ответ пустой, выбрасывает ошибку.
4. Возвращает полученные данные статьи.
5. Если возникла ошибка (например, запрос завершился неудачей), выводит ошибку в консоль и использует `rejectWithValue` для возврата метки ошибки ('error').

Эта функция является частью управления состоянием Redux и предназначена для использования в асинхронных операциях, таких как получение данных о статье по её ID.

---

# Селекторы

### `getArticleDetailsData`

Получение данных деталей статьи из состояния Redux.

**Принимает**

- `state: StateSchema` - объект состояния Redux.

**Возвращает**

Данные о деталях статьи. Если данные отсутствуют, возвращает `undefined`.

---

### `getCanCurrentUserEditArticle`

Проверка, может ли текущий пользователь редактировать статью.

**Принимает**

- `getUserAuthData` - селектор для получения данных аутентифицированного пользователя.
- `getArticleDetailsData` - селектор для получения данных деталей статьи.

**Возвращает**

`true`, если текущий пользователь может редактировать статью (текущий пользователь авторизован и его ID совпадает с ID автора статьи), иначе `false`.

---

# Константы

### `ArticleSortField`

Перечисление, которое определяет поля, по которым можно сортировать статьи. Возможные значения:

- `VIEWS`: Сортировка по количеству просмотров.
- `TITLE`: Сортировка по заголовку.
- `CREATED`: Сортировка по дате создания.

---

### `ArticleBlockType`

Перечисление, которое определяет типы блоков, используемых в статьях. Возможные значения:

- `TEXT`: Текстовый блок.
- `CODE`: Блок с кодом.
- `IMAGE`: Блок с изображением.

---

### `ArticleType`

Перечисление, которое определяет типы или категории статей. Возможные значения:

- `ALL`: Все типы статей.
- `IT`: Статьи категории IT.
- `COMPUTER_SCIENCE`: Статьи категории компьютерных наук.
- `ECONOMICS`: Статьи категории экономики.

---

### `ArticleView`

Перечисление, которое определяет типы отображения статей. Возможные значения:

- `BIG`: Большой вид отображения статей.
- `SMALL`: Маленький вид отображения статей.


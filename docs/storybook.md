# Storybook

В рамках проекта для каждого компонента описываются стори-кейсы. 

Для имитации запросов к серверу используется storybook-addon-mock.

Для создания стори-кейсов создается файл рядом с компонентом с расширением *.stories.tsx.

Для запуска Storybook используйте команду:

```shell
npm run storybook
```

Пример создания стори-кейса:

```typescript jsx
import type { Meta, StoryObj } from '@storybook/react';

import { Button } from './Button';

const meta: Meta<typeof Button> = {
	title: 'shared/redesigned/Button',
	component: Button,
	tags: ['autodocs'],
};

export default meta;
type Story = StoryObj<typeof Button>;

export const Normal: Story = {
	args: {
		children: 'Text',
	},
};

export const Clear: Story = {
	args: {
		children: 'Text',
		variant: 'clear',
	},
};

export const Outline: Story = {
	args: {
		children: 'Text',
		variant: 'outline',
	},
};
```

---

# Плагины

При настройке Storybook в проекте были подключены два плагина, которые предоставляют удобные способы тестирования интернационализации и изменения тем интерфейса прямо из интерфейса Storybook.

***Чтобы переключить язык или тему нужно посмотреть на значок глобуса или языка сверху слева в интерфейсе** 

### Плагин интернационализации

Для удобной проверки интернационализации был подключен плагин, позволяющий менять язык интерфейса в режиме просмотра Storybook. С помощью глобального типа `locale` можно выбирать доступные языки интерфейса:

```markdown
globalTypes: {
  locale: {
    name: 'Locale',
    description: 'Internationalization locale',
    toolbar: {
      icon: 'globe',
      items: [
        { value: 'ru', title: 'Русский' },
        { value: 'en', title: 'English' },
      ],
      showName: true,
    },
  },
}
```

### Плагин изменения темы

Для проверки различных тем оформления интерфейса был подключен плагин, позволяющий изменять тему прямо из интерфейса Storybook. С помощью параметра `themes` можно переключаться между доступными темами:

```markdown
parameters: {
  // ...другие параметры...
  themes: {
    default: 'light',
    list: [
      { name: 'light', class: ['app', Theme.LIGHT], color: '#e8e8ea' },
      { name: 'dark', class: ['app', Theme.DARK], color: '#090949' },
      // ...другие темы...
    ],
  },
}
```

Эти плагины облегчают проверку интернационализации и стилей для разных тем во время разработки компонентов в Storybook.

---

# Декораторы

---

## Декоратор DisabledAnimationsDecorator

Декоратор `DisabledAnimationsDecorator` представляет собой функцию, предназначенную для отключения анимаций в компонентах при использовании Storybook. Он создает контекст `DisableAnimationsContext`, который устанавливает значение `false` или `true` в зависимости от того, запущена ли библиотека Loki для отладки анимаций.

### Описание декоратора

Декоратор `DisabledAnimationsDecorator` выполняет следующие действия:

- Создает интерфейс `LokiWindow` для представления глобального объекта `window` с поддержкой Loki.

- Определяет функцию `isLokiRunning`, которая проверяет, работает ли Loki (если он установлен) с помощью свойства `loki.isRunning`.

- Создает контекст `DisableAnimationsContext` с начальным значением `false`, предназначенным для контроля анимаций.

- Функция-обертка `DisabledAnimationsDecorator` принимает компонент-историю (`StoryComponent`) в качестве аргумента.

- Внутри функции-обертки `StoryComponent` обертывается в `DisableAnimationsContext.Provider`, передавая значение `isLokiRunning()`.


Данный декоратор может быть добавлен к настройкам Storybook для проверки компонентов без анимаций при необходимости. 

В первую очередь он необходим для того, чтобы скриншотные тесты проводились корректно и не падали от того, что скелетон немного сдвинулся.

---

## Декоратор FeatureFlagsDecorator

Декоратор `FeatureFlagsDecorator` представляет собой функцию, которая используется для установки флагов функциональности во время отображения компонентов в Storybook. Это позволяет проверять различные наборы функций и возможностей, активируя или деактивируя определенные флаги.

### Описание декоратора

Декоратор `FeatureFlagsDecorator` выполняет следующие действия:

- Принимает объект флагов функциональности в качестве аргумента.

- Использует функцию `setFeatureFlags` для установки переданных флагов.

- Принимает компонент-историю (Story Component) в качестве аргумента.

- При применении декоратора, флаги функциональности, переданные в аргументе, будут применяться к компоненту во время его отображения в Storybook.


Данный декоратор позволяет удобно проверять компоненты с разными флагами функциональности, что может быть полезным при тестировании и разработке новых возможностей в приложении.

---

## Декоратор I18nDecorator

Декоратор `I18nDecorator` представляет собой функцию, используемую для настройки механизма интернационализации в Storybook. Он обеспечивает смену языка в соответствии с глобальными настройками и рендерит компоненты с учетом выбранного языка.

### Описание декоратора

Декоратор `I18nDecorator` выполняет следующие действия:

- Принимает компонент-историю (`Story`) и контекст истории (`context`) в качестве аргументов.

- Извлекает текущий язык (`locale`) из глобальных настроек контекста.

- Использует хук `useEffect`, чтобы при каждом изменении языка (`locale`) вызывать функцию `changeLanguage` из объекта `i18nForTest`. Это позволяет динамически изменять язык интернационализации.

- Оборачивает компонент-историю в компоненты `Suspense` и `I18nextProvider`. `Suspense` обеспечивает отображение заглушки (fallback) во время загрузки переводов. `I18nextProvider` предоставляет объект `i18nForTest` в качестве контекста для компонентов, чтобы они могли использовать соответствующие переводы.

Данный декоратор обеспечивает корректную работу интернационализации в Storybook, позволяя проверять компоненты с разными языковыми настройками во время разработки и тестирования.

---

## Декоратор NewDesignDecorator

Декоратор `NewDesignDecorator` предназначен для применения нового дизайна к компонентам, а также для установки флага функциональности `isAppRedesigned` в значение `true`. Это может использоваться для проверки внешнего вида и стилей компонентов в новом дизайне.

### Описание декоратора

Декоратор `NewDesignDecorator` выполняет следующие действия:

- Принимает компонент-историю (`StoryComponent`) в качестве аргумента.

- Использует функцию `setFeatureFlags` из библиотеки `@/shared/lib/features`, чтобы установить флаг функциональности `isAppRedesigned` в `true`, дополняя текущие флаги функциональности.

- Оборачивает компонент-историю в `<div>` с классом `app_redesigned`, чтобы применить стили для нового дизайна.

- Возвращает обернутый компонент-историю с примененным новым дизайном и установленным флагом.

Данный декоратор позволяет проверять, как компоненты выглядят и ведут себя в новом дизайне, а также активировать новые стили и функции при тестировании и разработке.

---

## Декоратор PaddingDecorator

Декоратор `PaddingDecorator` предназначен для добавления внутреннего отступа (padding) к компонентам в Storybook. Это может использоваться для проверки, как компоненты выглядят с добавленными отступами.

### Описание декоратора

Декоратор `PaddingDecorator` выполняет следующие действия:

- Принимает компонент-историю (`Story`) в качестве аргумента.

- Создает обертку в виде `<div>`, внутри которой устанавливает стиль с внутренним отступом (`padding`) в `1rem`.

- Размещает компонент-историю внутри созданной обертки.

- Возвращает обернутый компонент-историю с добавленным внутренним отступом.

Данный декоратор позволяет проверять, как компоненты выглядят с добавленными отступами, что может быть полезным при настройке внешнего вида компонентов.

---

## Декоратор RouterDecorator

Декоратор `RouterDecorator` предназначен для оборачивания компонентов в компонент `BrowserRouter` из библиотеки `react-router-dom`. Это позволяет проверять, как компоненты ведут себя внутри маршрутизатора.

### Описание декоратора

Декоратор `RouterDecorator` выполняет следующие действия:

- Принимает компонент-историю (`Story`) в качестве аргумента.

- Оборачивает компонент-историю в компонент `BrowserRouter`, который предоставляет маршрутизацию для компонентов.

- Возвращает обернутый компонент-историю с добавленной маршрутизацией.

Данный декоратор полезен для проверки компонентов, которые используют маршрутизацию через `react-router-dom`, и позволяет убедиться, что они корректно взаимодействуют с маршрутами и обрабатывают переходы между страницами.

---

## Декоратор StoreDecorator

Декоратор `StoreDecorator` предназначен для предоставления глобального хранилища (store) в компоненты Storybook. Он позволяет настроить начальное состояние хранилища и добавить асинхронные редюсеры (asyncReducers) для тестирования разных состояний приложения.

### Описание декоратора

Декоратор `StoreDecorator` выполняет следующие действия:

- Принимает начальное состояние (`state`) и дополнительные асинхронные редюсеры (`asyncReducers`) в качестве аргументов.

- Импортирует редюсеры для различных частей приложения, такие как логин, профиль, детали статьи и др.

- Создает объект `defaultAsyncReducers`, включающий в себя редюсеры по умолчанию для различных частей приложения.

- Возвращает функцию, которая принимает компонент-историю (`Story`) в качестве аргумента.

- Оборачивает компонент-историю в компонент `StoreProvider` из библиотеки `@/app/providers/StoreProvider`, предоставляя глобальное хранилище. В `StoreProvider` передаются начальное состояние и объединенные асинхронные редюсеры.

- Возвращает обернутый компонент-историю с предоставленным хранилищем.

Данный декоратор позволяет тестировать компоненты Storybook с разными состояниями хранилища, что может быть полезно для проверки взаимодействия компонентов с глобальным состоянием приложения.

---

## Декоратор StyleDecorator

Декоратор `StyleDecorator` предназначен для добавления стилей к компонентам в Storybook. В данном случае, он импортирует глобальные стили из файлa `index.scss`, что позволяет проверить, как компоненты выглядят с примененными стилями.

### Описание декоратора

Декоратор `StyleDecorator` выполняет следующие действия:

- Импортирует глобальные стили из файла `index.scss`.

- Принимает компонент-историю (`Story`) в качестве аргумента.

- Возвращает компонент-историю без изменений.

Данный декоратор позволяет проверить, как компоненты выглядят с примененными глобальными стилями, что может быть полезным при настройке внешнего вида компонентов.

---

## Декоратор SuspenseDecorator

Декоратор `SuspenseDecorator` предназначен для оборачивания компонентов в компонент `Suspense` из библиотеки `react`. Это позволяет проверить, как компоненты ведут себя в контексте использования компонента-заглушки для ленивой загрузки.

### Описание декоратора

Декоратор `SuspenseDecorator` выполняет следующие действия:

- Принимает компонент-историю (`Story`) в качестве аргумента.

- Оборачивает компонент-историю в компонент `Suspense`, который предоставляет механизм ожидания ленивой загрузки компонентов.

- Возвращает обернутый компонент-историю с добавленным компонентом-заглушкой.

### Пример использования

Данный декоратор полезен для проверки компонентов, которые используют ленивую загрузку (Code Splitting) через `Suspense` и `React.lazy()`, и позволяет убедиться, что компоненты корректно обрабатывают ожидание ленивой загрузки.

---

## Декоратор ThemeDecorator

Декоратор `ThemeDecorator` предназначен для применения темы (стилей) к компонентам в Storybook. Он использует компонент `ThemeProvider` из библиотеки `@/app/providers/ThemeProvider` для предоставления темы компонентам.

### Описание декоратора

Декоратор `ThemeDecorator` выполняет следующие действия:

- Импортирует компоненты `Theme` и `ThemeProvider` из библиотеки `@/app/providers/ThemeProvider`.

- Принимает тему (`theme`) в качестве аргумента.

- Возвращает функцию, которая принимает компонент-историю (`Story`) в качестве аргумента.

- Оборачивает компонент-историю в компонент `ThemeProvider` с указанной темой.

- Возвращает обернутый компонент-историю с примененной темой.

### Пример использования

Данный декоратор позволяет проверить, как компоненты выглядят с разными темами, что может быть полезным при настройке внешнего вида приложения.

---

